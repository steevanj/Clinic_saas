{% extends "base.html" %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/billing.css' %}">

<h2 class="billing-title">Billing</h2>

<div class="billing-table-wrapper">
  <table class="billing-table">
    <thead>
      <tr>
        <th>Patient</th>
        <th>Doctor</th>
        <th>Amount</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      {% for invoice in invoices %}
      <tr>
        <td>{{ invoice.appointment.patient.name }}</td>
        <td>{{ invoice.appointment.doctor.user.get_full_name }}</td>
        <td>₹{{ invoice.total_amount }}</td>
        <td>
          {% if invoice.payment_status == "PAID" %}
            <span class="status-paid">Paid</span>
          {% else %}
            <span class="status-pending">Pending</span>
          {% endif %}
        </td>
        <td>
          {% if invoice.payment_status == "PENDING" %}
          <form method="POST"
                action="{% url 'billing:pay' invoice.id %}"
                class="payment-form">
            {% csrf_token %}

            <select name="payment_method">
              <option value="CASH">Cash</option>
              <option value="UPI">UPI</option>
              <option value="CARD">Card</option>
            </select>

            <input name="transaction_reference"
                   placeholder="Txn Ref (optional)">

            <button class="btn-primary">
              Mark Paid
            </button>
          </form>
          {% else %}
            —
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="empty-row">
          No invoices
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
